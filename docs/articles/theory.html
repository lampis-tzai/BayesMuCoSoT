<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BayesMuCoSoT">
<title>Theory â€¢ BayesMuCoSoT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Theory">
<meta property="og:description" content="BayesMuCoSoT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BayesMuCoSoT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/examples_markdown.html">Examples markdown</a>
    <a class="dropdown-item" href="../articles/theory.html">Theory</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Theory</h1>
                        <h4 data-toc-skip class="author">Lampis
Tzai</h4>
            
            <h4 data-toc-skip class="date">2023-06-26</h4>
      
      
      <div class="d-none name"><code>theory.Rmd</code></div>
    </div>

    
    
<p>This library aims to help you to test if two multivariate data comes
from the same source or different sources. Otherwise, more usually we
know the source of one data-set and we want to test if another unknown
source data-set comes from the same source or different sources. Namely,
the hypotheses we are testing are the following:</p>
<p><span class="math display">\[H_p:
The\;unknown\;and\;the\;known\;data\; come \;from\; the\; same
\;source\]</span></p>
<p><span class="math display">\[H_d:
The\;unknown\;and\;the\;known\;data\; come \;from\; different
\;sources\]</span></p>
<p>The hypotheses assessed by means of the Bayes factor, which can be
interpreted as a measure of the strength of support provided by the
evidence in favor of the hypothesis <span class="math inline">\(H_p\)</span> against the hypothesis <span class="math inline">\(H_d\)</span> and mathematically is expressed based
on the odds form of Bayes Theorem:</p>
<p><span class="math display">\[
     \underbrace{\frac{P(H_p|\pmb{x},\pmb{I})}{P(H_d|\pmb{x},\pmb{I})}}_{\text{Posterior
Odds}}=\underbrace{\frac{P(\pmb{x}|H_p,\pmb{I})}{P(\pmb{x}|H_d,\pmb{I})}}_{\text{Bayes
Factor}} \times
\underbrace{\frac{P(H_p|\pmb{I})}{P(H_d|\pmb{I})}}_{\text{Prior Odds}}
\]</span></p>
<p>where <span class="math inline">\(\pmb{x}\)</span> is the realization
of the data and <span class="math inline">\(\pmb{I}\)</span> is the
relevant background information common to both propositions.</p>
<p>In this tutorial article we present the data modeling, prior
elicitation and the estimations of the marginal likelihood in order to
measure the Bayes factor.</p>
<div class="section level2">
<h2 id="bayesian-modelling">Bayesian Modelling<a class="anchor" aria-label="anchor" href="#bayesian-modelling"></a>
</h2>
<p>First of all we assume that the data with observations <span class="math inline">\(j\)</span> of every source <span class="math inline">\(i\)</span> are following Multivariate Normal
distribution <span class="math inline">\(N_p(
\pmb{\theta}_i,\pmb{W}_i)\)</span> with unknown parameters, <span class="math inline">\(\pmb{\theta}_i\)</span> the mean and <span class="math inline">\(\pmb{W}_i\)</span> the covariance matrix, or in
case with predictors <span class="math inline">\(N_p(\pmb{C}_{i,j}\pmb{\Theta}_i,\pmb{W}_i)\)</span>
where the <span class="math inline">\(\pmb{C}_i\)</span> be the
predictors with shape n <span class="math inline">\(\times\)</span> d
and <span class="math inline">\(\pmb{\Theta}_i\)</span> is the
coefficient matrix (d <span class="math inline">\(\times\)</span> p). We
analyze two main Bayesian approaches of data modeling:</p>
<ul>
<li>Conjugate analysis.</li>
<li>Independent prior modelling (including between sources
variability)</li>
</ul>
<p>We are going to present only the modelling with predictors (Bayesian
Multivariate Regression). Without predictors the matrix <span class="math inline">\(\pmb{C}_i\)</span> is a vector with all values
equal to 1.</p>
<div class="section level3">
<h3 id="conjugate-analysis">Conjugate analysis<a class="anchor" aria-label="anchor" href="#conjugate-analysis"></a>
</h3>
<p>In conjugate approach the combined modelling of data can be described
as:</p>
<p><span class="math display">\[\pmb{x}_{i,j} \sim
N_p(\pmb{C}_{i,j}\pmb{\Theta}_i,\pmb{W}_i)\\
    \pmb{\Theta}_i|\pmb{W}_i \sim MN_{l,p}(
\pmb{M},\pmb{K}_0^{-1},\pmb{W}_i)\\
    \pmb{W}_i \sim IW(\pmb{U},\nu)\\
    \]</span></p>
<p>where <span class="math inline">\(\pmb{\Theta}_i\)</span> is the
coefficient matrix (d <span class="math inline">\(\times\)</span> p),
<span class="math inline">\(\pmb{W}_i\)</span> is the non-constant
within-source covariance matrix, <span class="math inline">\(\nu\)</span> the degrees of freedom,<span class="math inline">\(\pmb{U}\)</span> the scale matrix of the
inverse-Wishart distribution, <span class="math inline">\(\pmb{M}\)</span> is the prior matrix mean (d<span class="math inline">\(\times\)</span>p) and <span class="math inline">\(\pmb{K}_0\)</span> the matrix of prior
measurements (d<span class="math inline">\(\times\)</span>d) on the W
scale, in the way that <span class="math inline">\(vec(\pmb{\Theta}_i)
\sim N_{l\times p}(vec(\pmb{M}),\pmb{W}_i \otimes
\pmb{K}_0^{-1})\)</span>. The natural conjugate prior using the
vectorized variable <span class="math inline">\(\pmb{\Theta}_i\)</span>
is of the form:</p>
<p><span class="math display">\[
    \pmb{W}_i \sim IW(\pmb{U},\nu)\\
    vec(\pmb{\Theta}_i)|\pmb{W}_i \sim N_{l\times
p}(vec(\pmb{M}),\pmb{W}_i \otimes \pmb{K}_0^{-1}))\\\]</span></p>
<p>Using the above prior and likelihood, the posterior distribution can
be expressed as a result of the same family. Hence, the marginal
likelihood <span class="math inline">\(m(\pmb{x})\)</span> can be
expressed in close form:</p>
<p><span class="math display">\[
m(\pmb{x}) =
\frac{1}{2\pi^{np/2}}\frac{\Gamma_p(\nu_n/2)}{\Gamma_p(\nu_0/2)}\frac{|\pmb{U}/2|^{\nu/2}}{|\pmb{U}_n/2|^{\nu_n/2}}\left(\frac{|\pmb{K}_0|}{|\pmb{K}_n|}\right)^{p/2}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> the sample size, <span class="math inline">\(p\)</span> the number of variables, <span class="math inline">\(\Gamma_p\)</span> the multivariate gamma function,
<span class="math inline">\(\nu_n = \nu + n\)</span>, <span class="math inline">\(\pmb{K}_n = \pmb{C}^T\pmb{C}+\pmb{K}_0\)</span>,
<span class="math inline">\(\pmb{U}_n = \pmb{U} + \pmb{x}^T\pmb{x} +
\pmb{M}^T\pmb{K}_0\pmb{M} - \pmb{M}_n^T\pmb{K}_n\pmb{M}_n\)</span> and
<span class="math inline">\(\pmb{M}_n = \pmb{K}_n^{-1}\left(
\pmb{C}^T\pmb{x} + \pmb{K}_0\pmb{M}\right)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="independent-prior-modelling">Independent prior modelling<a class="anchor" aria-label="anchor" href="#independent-prior-modelling"></a>
</h3>
<p>By including between sources variability, the data can be modeled in
the following way:</p>
<p><span class="math display">\[    \pmb{x}_{i,j} \sim
N_p(\pmb{C}_{i,j}\pmb{\Theta}_i,\pmb{W}_i)\\
    for\;d\;in\;(1,\dots,D)\\
    \pmb{\theta}_{id} \sim N_p( \pmb{\mu}_d,\pmb{B}_d)\\
    \pmb{W}_i \sim IW(\pmb{U},\nu)\\\]</span></p>
<p>where for the i-th source the <span class="math inline">\(\pmb{\Theta}_i\)</span> is the coefficient matrix
(d <span class="math inline">\(\times\)</span> p), <span class="math inline">\(\pmb{C}_i\)</span> is the predictors matrix as
described before with shape n <span class="math inline">\(\times\)</span> d, <span class="math inline">\(\pmb{W}_{i}\)</span> is the non-constant
within-writer covariance matrix, <span class="math inline">\(\pmb{\theta}_d\)</span> is the model coefficient
vector of the <span class="math inline">\('d'\)</span>
predictor, <span class="math inline">\(\pmb{\mu}_d\)</span> is the mean
vector of the <span class="math inline">\('d'\)</span> predictor
between sources and <span class="math inline">\(\pmb{B}_d\)</span> is
the between-sources covariance matrix of the <span class="math inline">\('d'\)</span> predictor.</p>
<p>The marginal likelihood of this model has no analytical form. Hence,
for the calculation of the marginal likelihood is needed the posterior
probability distribution of the model for all the approaches in Section
<span class="math inline">\(\pmb{Marginal\;Likelihood\;estimations}\)</span>.
Thus, for extracting sample from the posterior probability distribution
it was applied Gibbs sampling by utilizing the implementation of
JAGS.</p>
</div>
</div>
<div class="section level2">
<h2 id="prior-elicitation">Prior Elicitation<a class="anchor" aria-label="anchor" href="#prior-elicitation"></a>
</h2>
<p>For the Bayesian modelling the prior parameters can be elicited from
the background data-set with <span class="math inline">\(H\)</span>
available different sources and are notated as <span class="math inline">\({}_b\pmb{x}\)</span> and <span class="math inline">\({}_b\pmb{C}\)</span>.</p>
<p><span class="math display">\[ \pmb{M} =
({}_b\pmb{C}^{T}{}_b\pmb{C})^{-1}{}_b\pmb{C}^{T}{}_b\pmb{x}\]</span></p>
<p><span class="math display">\[ \pmb{B}_{p \times p,l}  =
\frac{1}{H-1}\sum_{h=1}^H  (\pmb{M}_h - \pmb{M})(\pmb{M}_h -
\pmb{M})^T\]</span></p>
<p>The <span class="math inline">\(\pmb{U}\)</span> and <span class="math inline">\(\nu\)</span> parameters of the inverse Wishart
distribution that describe the within-source variation can be elicited
by</p>
<p><span class="math display">\[\hat{\pmb{U}} =
E[\pmb{W}_i](\nu-p-1)\]</span></p>
<p><span class="math display">\[ E[\pmb{W}] = \hat{\pmb{W}}_{p \times
p}  = \frac{1}{n-H}\sum_{h=1}^H \sum_{j=1}^{n_h}({}_b\pmb{x}_{hj} -
{}_b\pmb{C}_{hj}M_h)({}_b\pmb{x}_{hj} -
{}_b\pmb{C}_{hj}M_h)^T\]</span></p>
<p>where <span class="math inline">\(n = \sum_{h=1}^H n_h\)</span> total
observations.</p>
<p>The smallest value for <span class="math inline">\(\nu\)</span> is
given by <span class="math display">\[\nu \geq p+2\]</span></p>
<p>The default value of the library.</p>
<p>For the parameter <span class="math inline">\(\pmb{K}_0\)</span> of
the conjugate approach that represent the matrix of prior measurements
on the W scale, we expressed as the double value of W scale matrix.
Hence, the default estimation in the library is diag(0.5,d,d).</p>
</div>
<div class="section level2">
<h2 id="marginal-likelihood-estimations">Marginal Likelihood estimations<a class="anchor" aria-label="anchor" href="#marginal-likelihood-estimations"></a>
</h2>
<p>As we mentioned above for the independent prior approach the marginal
likelihood <span class="math inline">\(m(x)\)</span> is not known in
closed form. Hence, it is estimated by using three different marginal
likelihood <span class="math inline">\(m(x)\)</span> approaches:</p>
<ol style="list-style-type: decimal">
<li>Generalized harmonic mean (Gelfand &amp; Dey (1994))</li>
<li>Laplace-Metropolis (Lewis &amp; Raftery (1997))</li>
<li>Bridge Sampling (Meng &amp; Wong (1996))</li>
</ol>
<p>For more details see the paper.</p>
</div>
<div class="section level2">
<h2 id="bayes-factor">Bayes Factor<a class="anchor" aria-label="anchor" href="#bayes-factor"></a>
</h2>
<p>The calculated Bayes factor is the following:</p>
<p><span class="math display">\[BF = \frac{m(x_1,x_2|H_p,
I)}{m(x_1,x_2|H_d, I)} = \frac{m(x_1,x_2|
I)}{m(x_1|I)m(x_2|I)}\]</span></p>
<ul>
<li><p>In the numerator we assume dependence between two data sources,
common modelling.</p></li>
<li><p>In the denumerator we assume independence between two data
sources, different modelling per data source.</p></li>
</ul>
<p>Hence, if the data come from the same source the numerator expected
to be bigger than the denumerator. Otherwise, if the data come from
different sources the denumerator expected to be bigger than the
numerator.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lampis Tzai.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
